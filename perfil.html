<script>
document.addEventListener("DOMContentLoaded", ()=>{

const btnPerfil = document.getElementById('btnPerfil');
const panelPerfil = document.getElementById('panel-perfil');
const btnCerrarPerfil = document.getElementById('btnCerrarPerfil');
const btnGuardarCambios = document.getElementById('btnGuardarCambios');
const avatarPreview = document.getElementById('avatar-preview');
const inputAvatar = document.getElementById('nuevoAvatar');
const inputNombre = document.getElementById('nuevoNombre');
const inputClave = document.getElementById('nuevaClave');
const usuarioActivo = document.getElementById('usuarioActivo');
const btnLogout = document.getElementById('btnLogout');

// Cargar usuario desde localStorage o crear por defecto
let usuario = JSON.parse(localStorage.getItem('usuario')) || {
    nombre:'Cofundador',
    clave:'1234',
    avatar:'https://i.ibb.co/781Qj0J/logo.png'
};

// Función para mostrar usuario en la barra
function mostrarUsuario(){
    usuarioActivo.textContent = usuario.nombre;
    avatarPreview.src = usuario.avatar;
}
mostrarUsuario();

// Abrir panel
btnPerfil.addEventListener('click', () => {
    panelPerfil.style.display = 'block';
    inputNombre.value = usuario.nombre;
    inputClave.value = usuario.clave;
    avatarPreview.src = usuario.avatar;
});

// Cerrar panel
btnCerrarPerfil.addEventListener('click', () => {
    panelPerfil.style.display = 'none';
});

// Previsualizar avatar al seleccionar
inputAvatar.addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = ()=> avatarPreview.src = reader.result;
        reader.readAsDataURL(file);
    }
});

// Guardar cambios
btnGuardarCambios.addEventListener('click', ()=>{
    usuario.nombre = inputNombre.value || usuario.nombre;
    usuario.clave = inputClave.value || usuario.clave;
    usuario.avatar = avatarPreview.src;
    localStorage.setItem('usuario', JSON.stringify(usuario));
    mostrarUsuario();
    panelPerfil.style.display = 'none';
    alert('Perfil actualizado correctamente!');
});

// Logout
btnLogout.addEventListener('click', ()=>{
    localStorage.removeItem('usuario');
    alert('Sesión cerrada');
    location.reload();
});

});
</script>
