<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LCDM COLECCION</title>
<link rel="stylesheet" href="style.css">

<style>
/* Overlay m치ximo */
#completado-overlay {
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #fff;
    font-family: sans-serif;
    font-size: 2rem;
    z-index: 9999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s;
    overflow: hidden;
}
#completado-overlay.visible { opacity: 1; pointer-events: all; }
#completado-overlay h1 {
    font-size: 3rem;
    animation: parpadeo 1s infinite alternate;
    color: gold;
    text-shadow: 0 0 10px #fff, 0 0 20px yellow;
}
#completado-overlay p { font-size: 1.8rem; text-align: center; }
#completado-overlay canvas { position: absolute; top:0; left:0; }
@keyframes parpadeo {
    0% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.1); }
    100% { opacity: 1; transform: scale(1); }
}

/* Overlay de mensajes */
#overlay-msg {
    position: fixed;
    top:50%; left:50%;
    transform: translate(-50%,-50%);
    background: rgba(0,0,0,0.95);
    color: #fff;
    font-size:1.5rem;
    padding:2rem;
    border-radius:15px;
    z-index:99999;
    display:none;
    text-align:center;
}
#overlay-msg button {
    margin-top:1rem;
    padding:0.5rem 1rem;
    font-size:1rem;
    cursor:pointer;
    border:none;
    border-radius:5px;
    background: gold;
    color:black;
    font-weight:bold;
}

/* Panel de usuario */
#panel-perfil {
    display:none;
    position: fixed;
    top:50%; left:50%;
    transform: translate(-50%,-50%);
    background: #111;
    color: #fff;
    padding:2rem;
    border-radius:15px;
    z-index:10000;
    width: 300px;
    text-align:center;
}
#panel-perfil input {
    width: 90%;
    padding:0.5rem;
    margin:0.5rem 0;
    border-radius:5px;
    border:none;
    font-size:1rem;
}
#panel-perfil button {
    padding:0.5rem 1rem;
    margin-top:1rem;
    border:none;
    border-radius:5px;
    background: gold;
    color:black;
    font-weight:bold;
    cursor:pointer;
}
#avatar-preview {
    width:80px;
    height:80px;
    border-radius:50%;
    margin-bottom:10px;
    object-fit: cover;
    border:2px solid gold;
}
#avatar-barra {
    width:30px;
    height:30px;
    border-radius:50%;
    border:1px solid gold;
    object-fit:cover;
}
</style>
</head>
<body>

<!-- Logo -->
<div id="logo-container">
  <a href="index.html">
    <img src="https://i.ibb.co/781Qj0J/logo.png" alt="Logo Los LCDM" id="logo">
  </a>
</div>

<!-- Barra superior -->
<div id="barra-superior" style="display:flex; align-items:center; gap:10px;">
  <img id="avatar-barra" src="https://i.ibb.co/781Qj0J/logo.png" alt="Avatar">
  <span id="usuarioActivo"></span>
  <span id="contador">0 / 5 Colecci칩n</span>
  <div style="position: relative; display: inline-block;">
    <button id="btnAyuda">Ayuda</button>
    <div id="tooltipAyuda">
      <div class="tooltipFlecha"></div>
      <div class="tooltipContenido">
        <h3>Ayuda / Reglas</h3>
        <p>
          1. Puedes coleccionar hasta 5 figuritas por d칤a.<br>
          2. Haz clic en cada figurita para ver su contenido.<br>
          3. 춰Disfruta del 치lbum y comparte con tus amigos!<br>
          4. Contin칰a agregando m치s reglas si lo deseas.<br>
          5. Personaliza todo el contenido.<br>
          6. Agrega im치genes si quieres.
        </p>
      </div>
    </div>
  </div>
  <button id="btnReiniciar">&#127873; Canjear Premio</button>
  <button id="btnLogout">Cerrar Sesi칩n</button>
  <a href="ranking.html" style="color:yellow;">游끥 Ranking</a>
  <button id="btnPerfil" style="color:orange;background:none;border:none;cursor:pointer;">丘뙖잺 Perfil</button>
</div>

<!-- 츼lbum -->
<div id="album-container">
  <h1>Mi Propia Colecci칩n</h1>
  <div class="figuritas" id="figuritasContainer"></div>
</div>

<!-- Escaneo QR -->
<div class="qr-section">
  <div id="qr-reader"></div>
  <button id="btnScanQR" onclick="iniciarScanner()">&#128247; Coleccionar QR</button>
</div>

<!-- Toast -->
<div id="toast"></div>
<div id="completado-overlay"></div>

<!-- Overlay mensajes -->
<div id="overlay-msg">
  <div id="overlay-msg-text"></div>
  <button id="overlay-msg-close">Cerrar</button>
</div>

<!-- Panel de usuario (Perfil) -->
<div id="panel-perfil">
  <h2>Mi Perfil</h2>
  <img id="avatar-preview" src="https://i.ibb.co/781Qj0J/logo.png" alt="Avatar">
  <input type="text" id="nuevoNombre" placeholder="Nuevo nombre">
  <input type="password" id="nuevaClave" placeholder="Nueva clave">
  <input type="file" id="nuevoAvatar" accept="image/*">
  <button id="btnGuardarCambios">Guardar Cambios</button>
  <button id="btnCerrarPerfil">Cerrar</button>
</div>

<!-- Librer칤as externas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>

<!-- Scripts del proyecto -->
<script src="codigos.js"></script>
<script src="qr.js"></script>
<script src="script.js"></script>

<script>
// ===== Perfil =====
const btnPerfil = document.getElementById('btnPerfil');
const panelPerfil = document.getElementById('panel-perfil');
const btnCerrarPerfil = document.getElementById('btnCerrarPerfil');
const btnGuardarCambios = document.getElementById('btnGuardarCambios');
const avatarPreview = document.getElementById('avatar-preview');
const inputAvatar = document.getElementById('nuevoAvatar');
const inputNombre = document.getElementById('nuevoNombre');
const inputClave = document.getElementById('nuevaClave');
const usuarioActivo = document.getElementById('usuarioActivo');
const avatarBarra = document.getElementById('avatar-barra');

// Cargar usuario desde localStorage o crear por defecto
let usuario = JSON.parse(localStorage.getItem('usuario')) || {nombre:'Cofundador', clave:'1234', avatar:'https://i.ibb.co/781Qj0J/logo.png'};

// Mostrar usuario activo y avatar en barra
function mostrarUsuario(){
    usuarioActivo.textContent = usuario.nombre;
    avatarPreview.src = usuario.avatar;
    avatarBarra.src = usuario.avatar;
}
mostrarUsuario();

// Abrir panel
btnPerfil.addEventListener('click', () => {
    panelPerfil.style.display = 'block';
    inputNombre.value = usuario.nombre;
    inputClave.value = usuario.clave;
    avatarPreview.src = usuario.avatar;
});

// Cerrar panel
btnCerrarPerfil.addEventListener('click', () => {
    panelPerfil.style.display = 'none';
});

// Previsualizar avatar al seleccionar
inputAvatar.addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = ()=> avatarPreview.src = reader.result;
        reader.readAsDataURL(file);
    }
});

// Guardar cambios
btnGuardarCambios.addEventListener('click', ()=>{
    usuario.nombre = inputNombre.value || usuario.nombre;
    usuario.clave = inputClave.value || usuario.clave;
    usuario.avatar = avatarPreview.src;
    localStorage.setItem('usuario', JSON.stringify(usuario));
    mostrarUsuario();
    panelPerfil.style.display = 'none';
    alert('Perfil actualizado correctamente!');
});

// Logout
document.getElementById('btnLogout').addEventListener('click', ()=>{
    localStorage.removeItem('usuario');
    alert('Sesi칩n cerrada');
    location.reload();
});
</script>

</body>
</html>
